# Создание презентаций на основе стиля из другого источника

Эксперимент: насколько хорошо AI-агент (Claude Code + навык pptx) умеет создавать PPTX-презентации, комбинируя **контент** с **визуальным стилем** из внешнего источника.

## TL;DR

AI-агент умеет создавать презентации из контента + стиля, но требует 2-3 раунда QA-правок. Лучше всего работает редактирование PPTX-шаблона (сохраняется вся графика). Генерация с нуля из PDF/брендбука даёт приемлемый результат, но теряет текстуры и упрощает раскладки. Основные проблемы: кириллица в шрифтах, наложение текстов при замене, искажение пропорций картинок. На 20 слайдов уходит ~1-1.5M токенов. Ключ к качеству — хороший шаблон, точный промпт и обязательная визуальная проверка.

## Тесты

| # | Папка | Источник стиля | Статус |
|---|-------|---------------|--------|
| 1 | `examples/1_pptx2pptx/` | PPTX-шаблон (SaaS Go-To-Market.pptx) | Готов |
| 2 | `examples/2_pdf2pptx/` | PDF-презентация (Elegant Black and Gold Pitch Deck.pdf) | Готов |
| 3 | `examples/3_pdf_brandbook2ppx/` | PDF-брендбук (brandbook.pdf) | Готов |
| 4 | `examples/4_pptx2ppx/` | PPTX-шаблон (Education Presentation Template.pptx) | Готов |



---

## Рекомендуемый промпт

### md + pptx -> pptx

```
В папке examples/1_pptx2pptx/ находится md-презентация и pptx-файл шаблона.
Я хочу на основе слайдов из md-презентации получить pptx с точно таким же
дизайном, как в шаблоне.

Используя навык pptx создай эту презентацию.
Результат сохрани как styled_<имя MD-файла>.pptx (например,
styled_Технологические_тренды_2024.pptx).
Все временные файлы (unpacked/, превью, QA-скриншоты) сохраняй
в папке temp/ внутри рабочей директории. Не удаляй их после работы.

Условия:
- Графические элементы шаблона должны сохраниться: картинки, фигуры,
  фоновые рисунки, градиенты, цвета, отступы, выравнивание.
- Если контент на русском или другом кириллическом языке, а шрифты
  шаблона не поддерживают кириллицу — подбери похожие с кириллицей
  (Google Fonts), скачай в папку fonts/. Для латиницы используй
  оригинальные шрифты.
- Если текст не помещается в строку — уменьши шрифт или расширь
  текстовый блок, сохраняя выравнивание. Русский текст обычно
  на 20-30% длиннее английского — учитывай это.
- Списки, надписи должны сохранить отступы. Ничего не должно наезжать
  друг на друга.
- Подбери разные слайды шаблона под разный контент. Типы слайдов должны
  чередоваться, не допускай однообразия.
- Таблицы из MD вставляй как настоящие таблицы PowerPoint (<a:tbl>),
  а не как текст с разделителями.
- Не искажай пропорции изображений. При вставке картинок и особенно
  логотипов используй sizing: { type: "contain" } (PptxGenJS) или
  эквивалент, чтобы сохранить исходное соотношение сторон.
  Логотипы нельзя растягивать или сплющивать.
- Используй ТОЛЬКО контент из MD-файла. Не придумывай текст,
  которого нет в исходной презентации.
```

### md + pdf -> pptx

```
В папке examples/2_pdf2pptx/ находится md-презентация и pdf-файл презентации-образца.
Извлеки визуальный стиль из PDF (цвета, шрифты, раскладки, оформление)
и создай pptx, применив этот стиль к контенту из MD.

Используя навык pptx создай эту презентацию.
Результат сохрани как styled_<имя MD-файла>.pptx.
Все временные файлы (generate.js, pdf_preview/, node_modules/, QA-скриншоты)
сохраняй в папке temp/ внутри рабочей директории. Не удаляй их после работы.

Условия:
- Воспроизведи цветовую палитру, типографику и раскладки из PDF.
- Поскольку PDF нельзя распаковать как шаблон — генерируй с нуля (PptxGenJS),
  максимально точно повторяя стиль.
- Извлеки фоновые текстуры и изображения из PDF (например, через PyMuPDF)
  и используй их как фон слайдов. Не заменяй текстуры плоскими заливками.
- Анализируй раскладку каждого типа слайда в PDF: где светлые зоны,
  где тёмные, какие пропорции. Не упрощай сложные макеты до однотонного фона.
- Если контент на русском или другом кириллическом языке, а шрифты
  из PDF не поддерживают кириллицу — подбери похожие с кириллицей
  (Google Fonts), скачай в папку fonts/. Для латиницы используй
  оригинальные шрифты.
- Если текст не помещается в строку — уменьши шрифт или расширь
  текстовый блок, сохраняя выравнивание. Русский текст обычно
  на 20-30% длиннее английского — учитывай это.
- Подбери разные раскладки под разный контент. Типы слайдов должны
  чередоваться, не допускай однообразия.
- Таблицы из MD вставляй как настоящие таблицы PowerPoint (<a:tbl>),
  а не как текст с разделителями.
- Не искажай пропорции изображений. При вставке картинок и особенно
  логотипов используй sizing: { type: "contain" } (PptxGenJS) или
  эквивалент, чтобы сохранить исходное соотношение сторон.
  Логотипы нельзя растягивать или сплющивать.
- Используй ТОЛЬКО контент из MD-файла. Не придумывай текст,
  которого нет в исходной презентации.
```

### md + brandbook -> pptx

```
В папке examples/3_pdf_brandbook2ppx/ находится md-презентация и PDF-брендбук.
Извлеки из брендбука фирменные цвета, шрифты, правила оформления
и создай pptx, оформленную по этим гайдлайнам.

Используя навык pptx создай эту презентацию.
Результат сохрани как styled_<имя MD-файла>.pptx.
Все временные файлы (generate.js, brandbook_pages/, node_modules/,
QA-скриншоты) сохраняй в папке temp/ внутри рабочей директории.
Не удаляй их после работы.

Условия:
- Следуй рекомендациям брендбука: цвета, шрифты, отступы, логотип.
- Генерируй с нуля (PptxGenJS), так как брендбук — не готовый шаблон.
- Если контент на русском или другом кириллическом языке, а шрифты
  из брендбука не поддерживают кириллицу — подбери похожие с кириллицей
  (Google Fonts), скачай в папку fonts/. Для латиницы используй
  оригинальные шрифты.
- Если текст не помещается в строку — уменьши шрифт или расширь
  текстовый блок, сохраняя выравнивание. Русский текст обычно
  на 20-30% длиннее английского — учитывай это.
- Подбери разные раскладки под разный контент. Типы слайдов должны
  чередоваться, не допускай однообразия.
- Таблицы из MD вставляй как настоящие таблицы PowerPoint (<a:tbl>),
  а не как текст с разделителями.
- Не искажай пропорции изображений. При вставке картинок и особенно
  логотипов используй sizing: { type: "contain" } (PptxGenJS) или
  эквивалент, чтобы сохранить исходное соотношение сторон.
  Логотипы нельзя растягивать или сплющивать.
- Если в брендбуке есть правила размещения логотипа (отступы,
  минимальный размер, свободное пространство) — соблюдай их.
- Используй ТОЛЬКО контент из MD-файла. Не придумывай текст,
  которого нет в исходной презентации.
```

### pptx (контент) + pptx (стиль) -> pptx

```
В папке examples/4_pptx2ppx/ находятся два pptx-файла:
- «Education Presentation Template.pptx» — шаблон (источник стиля, 27 слайдов)
- «E-Learning Slides Content.pptx» — контент (20 слайдов)

Возьми контент (текст, структуру слайдов) из E-Learning и оформи его
в стиле Education Template. Результат сохрани как education_elearning.pptx.

Используя навык pptx создай эту презентацию.
Результат сохрани как styled_<имя контент-файла>.pptx (например,
styled_E-Learning Slides Content.pptx).
Все временные файлы (unpacked/, превью, QA-скриншоты) сохраняй
в папке temp/ внутри рабочей директории. Не удаляй их после работы.

Условия:
- Стратегия: распакуй шаблон (Education Template), подбери подходящие
  слайды шаблона под каждый слайд контента, замени текст.
- Графические элементы шаблона должны сохраниться: картинки, фигуры,
  фоновые рисунки, градиенты, цвета, отступы, выравнивание.
- Контент берётся только из E-Learning: заголовки, подзаголовки,
  тексты, списки. Не добавляй текст, которого нет в контенте.
- Подбери разные слайды шаблона под разный контент. Типы слайдов должны
  чередоваться, не допускай однообразия.
- Если текст не помещается в строку — уменьши шрифт или расширь
  текстовый блок, сохраняя выравнивание.
- Списки, надписи должны сохранить отступы. Ничего не должно наезжать
  друг на друга.
- Не искажай пропорции изображений. При вставке картинок и особенно
  логотипов используй sizing: { type: "contain" } (PptxGenJS) или
  эквивалент, чтобы сохранить исходное соотношение сторон.
- Если контент на русском или другом кириллическом языке, а шрифты
  шаблона не поддерживают кириллицу — подбери похожие с кириллицей
  (Google Fonts), скачай в папку fonts/. Для латиницы используй
  оригинальные шрифты.
```

---

## Известные проблемы

Проблемы, обнаруженные в ходе тестов.

### 1. Шрифты и кириллица

При генерации презентации на русском языке шрифты из англоязычных шаблонов часто не поддерживают кириллицу. При замене на «похожий» шрифт без учёта толщины и пропорций текст меняет размер, и надписи перестают помещаться в свои блоки.

**Совет:** ищите шаблоны, где шрифты уже поддерживают кириллицу, либо сразу шаблоны на русском языке. Безопасные шрифты с Google Fonts: Montserrat, Open Sans, Roboto, Inter, PT Sans.

### 2. Переполнение текста

При переводе контента с английского на русский текст удлиняется на 20-30%. Однострочные надписи и заголовки разбиваются на две строки, ломая вёрстку.

**Совет:** при переводе на русский нужно уменьшать шрифт или расширять текстовые блоки. Указывайте это в промпте явно.

### 3. Таблицы отображаются как текст

Агент может вставить данные таблицы как текст с разделителями вместо настоящей таблицы PowerPoint.

**Совет:** в промпте явно указывать: «таблицы вставляй как настоящие таблицы PowerPoint, а не как текст».

### 4. Придуманный контент

Агент может добавить текст, которого нет в MD: например, «Благодарим за внимание!» вместо «Спасибо», или выдумать контакты.

**Совет:** в промпте ограничивать: «используй ТОЛЬКО контент из MD-файла». После генерации сверять текст с исходником.

### 5. Большие картинки и медиа

Шаблоны с богатой графикой (20+ МБ) содержат десятки изображений. При удалении или дублировании слайдов могут появиться битые ссылки или раздутый размер файла. У некоторых агентов могут быть ограничения на размер картинок, с которыми он работает - например, Claude иногда вываливался в ошибку, если одна из сторон изображения больше 2000px.

**Совет:** выбирать шаблоны до 10 МБ. Не добавлять новые изображения без необходимости. Если агент не может обработать большие изображения, просить его написать скрипт-обработчик для уменьшения изображений.

### 6. Спецсимволы в тексте

Символы `&`, `<`, `>` в тексте ломают XML, если не экранированы. Например, «Computing & Connectivity» сломает файл.

**Совет:** проверять текст на спецсимволы перед началом работы. Просить агента экранировать спецсимволы.

### 7. Выбор стратегии генерации

Неправильный выбор между «редактировать шаблон» и «генерировать с нуля» приводит к потере оформления.

| Источник стиля | Стратегия |
|---|---|
| PPTX-шаблон | Распаковка + редактирование XML (сохраняет всю графику) |
| PDF-презентация | Генерация с нуля (PptxGenJS) |
| Брендбук (PDF) | Генерация с нуля (PptxGenJS) |

### 8. Шрифты в облачных средах

При работе в облачных или sandbox-средах (ChatGPT, Gemini, облачный Claude) агент может не иметь возможности скачать или установить нужные шрифты. Кириллица в этом случае отобразится системным шрифтом или квадратами.

**Совет:** для работы в облачных средах выбирайте шаблоны со стандартными шрифтами (Arial, Calibri, Times New Roman) или с уже встроенной кириллицей.

### 9. Текстуры заменяются плоскими заливками

При генерации с нуля из PDF агент анализирует цветовую палитру, но теряет текстуры и фоновые изображения. Вместо мраморного, тканевого или градиентного фона получается плоская однотонная заливка, и презентация выглядит бедно.

**Совет:** в промпте явно указывать: «извлеки фоновые текстуры из PDF и используй их, не заменяй плоскими заливками». Агент может извлечь изображения через PyMuPDF (`doc.extract_image()`).

### 10. Упрощение раскладок

Агент может проанализировать палитру (например, «чёрный и кремовый»), но не заметить, что на тёмных слайдах есть светлые зоны под заголовком или наоборот. В результате слайды получаются полностью однотонными, хотя в оригинале фон делился на зоны.

**Совет:** в промпте указывать: «анализируй раскладку каждого типа слайда — где светлые зоны, где тёмные, какие пропорции».

### 11. Искажение пропорций изображений

При генерации с нуля агент задаёт размеры изображений (`w`, `h`) вручную, не сверяясь с реальным соотношением сторон файла. Особенно критично для логотипов: круглая иконка становится овалом, текст «SANOFI» — растянутым или сплющенным.

**Причина:** в PptxGenJS если задать `addImage({ w, h })` без `sizing`, картинка растягивается до указанного прямоугольника. С `sizing: { type: "contain" }` — вписывается с сохранением пропорций.

**Совет:** в промпте явно указывать: «не искажай пропорции изображений, используй `sizing: { type: "contain" }`». После генерации визуально проверять логотипы.

---

## Расход токенов и управление стоимостью

### Примерный расход по тестам

| # | Тест | Слайдов | Стратегия | Input tokens | Output tokens |
|---|------|---------|-----------|-------------|---------------|
| 1 | md + pptx | 12 | Редактирование XML | ~500k-800k | ~50k-100k |
| 2 | md + pdf | 20 | PptxGenJS с нуля | ~400k-700k | ~80k-150k |
| 3 | md + brandbook | 51 | PptxGenJS с нуля | ~800k-1.5M | ~150k-250k |
| 4 | pptx + pptx | 20 | Редактирование XML | ~800k-1.5M | ~100k-200k |

*Оценки приблизительные, по размеру обработанных данных и числу раундов. Фактический расход зависит от модели и длины контекста.*

### Что влияет на расход

**Основные факторы (по убыванию влияния):**

1. **Размер XML слайдов** — самый крупный фактор при редактировании шаблона. Один слайд с богатым оформлением = 30-90k токенов. Чтение 20 слайдов для анализа может стоить 500k+ токенов. В 4 тесте некоторые слайды исходника при распаков ке в xml заняли более 1 Мб.
2. **Число раундов QA** — каждый цикл «экспорт → осмотр → правка → перепаковка» добавляет 50-150k. Обычно нужно 2-3 раунда.
3. **Субагенты** — каждый получает полный контекст задачи (30-100k). 4 параллельных субагента × 3 раунда = 400k-1.2M дополнительных токенов.
4. **Рост контекста** — к 30-му ходу диалога каждый новый вызов API несёт 100-200k накопленного контекста. Между тестами контект не очищался, но при реальном использовании - очищайте контекст, если он не нужен.
5. **Количество слайдов** — линейная зависимость: 51 слайд (тест 3) обошёлся втрое дороже 12 слайдов (тест 1).

### Как управлять расходом

| Приём | Эффект | Компромисс |
|-------|--------|------------|
| **Выбирать шаблоны с мастер-слайдами** | Оформление хранится в slideLayout/slideMaster, а не дублируется в каждом slide*.xml → XML в 3-5 раз легче | Не все шаблоны так устроены |
| **Параллельные субагенты** | Wall-clock время падает в 2-4 раза | Токены растут линейно — каждый агент тратит свой контекст |
| **Меньше слайдов** | Линейное снижение | Ограничивает контент |
| **Шаблоны из Google Slides** | Чистый XML, минимум мусора | Меньше визуального разнообразия |
| **Ограничить раунды QA** | -30-50% токенов | Ниже качество, могут остаться баги |
| **Лёгкие шаблоны (< 5 МБ)** | Меньше изображений и фигур, быстрее распаковка | Визуально беднее |

### Управление скоростью

- **Параллельные субагенты** — главный рычаг. Редактирование 20 слайдов 4 субагентами быстрее в ~3 раза.
- **Визуальная QA через PowerPoint COM** (Windows) — экспорт 20 слайдов за 5 сек, вместо LibreOffice → PDF → pdftoppm.
- **Пакетное редактирование** — группировать слайды по 4-5 на субагент, а не по одному.

### Управление качеством(по большей части рекомендации для ИИ)

- **Обязательная визуальная QA** — без неё остаются наложения текстов, leftover-плейсхолдеры и обрезанные надписи.
- **Свежие глаза (субагент для QA)** — кто редактировал, тот видит то, что ожидал, а не то, что есть.
- **Минимум 2 раунда** fix-and-verify — одна правка часто создаёт новую проблему.
- **Content QA (grep)** — после каждого редактирования проверять на leftover: `markitdown output.pptx | grep -iE "lorem|ipsum|placeholder"`.

---

## Советы по выбору шаблона

### Хорошие шаблоны

- 5-7 разных типов слайдов (титульный, разделитель, 2-колоночный, карточки, таблица, цитата, закрывающий)
- Шрифты с кириллицей (или шаблон сразу на русском)
- Из Google Slides (экспортированные в PPTX) — чистый XML, проще редактировать
- Размер до 10 МБ
- Без анимаций и переходов

### Проблемные шаблоны

- С вложенными группами элементов — сложно редактировать
- Со SmartArt или ActiveX — высокий риск поломки
- Где весь текст слайда в одном текстовом блоке вместо отдельных для заголовка, подзаголовка и тела

### Как писать MD-контент

- **Marp-формат** (`---` между слайдами, `##` заголовки, `- item` списки)
- **Размечайте типы слайдов** комментариями (`<!-- _class: divider -->`)
- **Таблицы** — через Markdown-синтаксис (`| col1 | col2 |`)
- **Не перегружайте слайды** — максимум 6 пунктов или 5 строк таблицы
- **Контакты и ссылки** — указывайте явно, иначе агент выдумает
- **Количество слайдов в MD = на выходе.** Агент не разобьёт длинный слайд на два сам

---
## Skills

### Навык pptx (Claude Code)

Все тесты использовали встроенный навык `pptx` от Anthropic. Он активируется автоматически в Claude Code при работе с .pptx файлами — отдельная установка не требуется.

**Что умеет:**
- Чтение содержимого (`markitdown`, `thumbnail.py`)
- Редактирование через распаковку XML (`unpack → edit → clean → pack`)
- Генерация с нуля через PptxGenJS
- Валидация структуры файла

### Навык presentation-from-style

В рамках эксперимента был написан навык `presentation-from-style` ([SKILL.md](presentation-from-style/SKILL.md)) — надстройка над базовым навыком `pptx`, заточенная под задачу «контент + стиль → презентация».

**Что в нём:** выбор стратегии по типу источника, пошаговый workflow, таблица 10 известных граблей, чеклист QA, рекомендации по шрифтам и токенам, сокращённый промпт.

**Нужен ли он?** При наличии подробных промптов из секции выше — скорее нет. Навык `pptx` уже содержит все необходимые скрипты и инструкции. Отдельный навык имеет смысл, если хочется давать короткие команды без копирования промпта каждый раз. Для этого нужно установить его в `.agents/skills/presentation-from-style/SKILL.md`.

**Сокращённый промпт (при установленном навыке):**

```
В папке <folder>/ находятся:
- <content_file> — контент
- <style_file> — стиль/шаблон

Используя навык presentation-from-style, создай презентацию
styled_<content_name>.pptx. Все временные файлы — в temp/.
```

Навык сам выберет стратегию, настроит шрифты, проведёт QA и учтёт известные грабли.


## Выводы

### Что работает хорошо

1. **Редактирование PPTX-шаблона** — лучшая стратегия, когда есть готовый шаблон. Сохраняется вся графика, фигуры, фоны. Агент корректно управляет структурой слайдов (удаление, перестановка, дублирование).
2. **Параллельная работа** — субагенты эффективно редактируют слайды параллельно (4 агента × 5 слайдов), ускоряя работу в 3-4 раза.
3. **QA-цикл** — связка «markitdown + grep» для текста и «экспорт в JPG + визуальный осмотр» для вёрстки надёжно ловит проблемы.
4. **Генерация с нуля (PptxGenJS)** — даёт хороший результат для 20-50 слайдов, воспроизводит цветовые палитры и типографику из PDF.

### Что работает с оговорками

1. **Кириллица** — требует явных инструкций в промпте и подбора шрифтов. Без этого текст не помещается в блоки и переносится на следующую строку, сбиваются отступы мжду строками.
2. **Сложные раскладки** — агент может упростить двухзонный фон до однотонной заливки. Нужно указывать в промпте «анализируй раскладку каждого типа слайда».
3. **Текстуры** — при генерации с нуля теряются. Нужно явно просить извлечь и использовать фоновые изображения.

### Что не работает или ненадёжно

1. **Первый результат без QA** — почти никогда не бывает идеальным. Leftover-плейсхолдеры, наложения, обрезки — нормальное явление. Обычно агент сам генерирует вторую версию, но. можно попросить перепроверить или явно указать, какие огрехи есть в результате.
2. **Пропорции картинок** — без явного `sizing: { type: "contain" }` логотипы искажаются.
3. **Большие шаблоны (> 10 МБ)** — огромные XML, долгая обработка, риск ошибок с картинками > 2000px.

### Рекомендации

- Используйте навык `pptx` — он содержит проверенный workflow (unpack → edit → clean → pack → QA).
- Всегда запускайте визуальную QA через субагент со свежим контекстом.
- Для кириллического контента выбирайте шаблоны с Google Fonts (Montserrat, Open Sans, Roboto).
- Бюджетируйте 2-3 раунда правок. Закладывайте ~1M токенов на 20 слайдов.
